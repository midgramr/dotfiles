unbind C-b
set -g prefix C-a
bind C-a send-prefix

# General config
set -g allow-rename off
set -gq allow-passthrough on
set -g visual-activity off
set -g default-terminal "$TERM"
set -g focus-events on
set -g detach-on-destroy off
set -s set-clipboard on
set -s buffer-limit 10
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on

# Copy-mode style
set -g mode-style "noattr fg=black bg=#e78a4e"

# Statusline
set -g status-style "fg=#a89984 bg=#32302f"
set -g status-justify left
set -g status-interval 1
set -g message-style "noattr bg=black fg=#e78a4e"

set -g status-left ""
set -g status-left-length 99

set -g status-right "#[bg=#3a3735] ÓØà #S #[bright fg=#282828 bg=#a89984] #h "
set -g status-right-length 99

# Statusline windows
set -g window-status-separator ""
set -g window-status-format "#{?window_marked_flag,#[bg=#e78a4e fg=black]} #W "
set -g window-status-current-format "#{?window_marked_flag,#[bg=#e78a4e fg=black]} #W "
set -g window-status-style "bg=#3a3735"
set -g window-status-current-style "fg=#ddc7a1 bg=#5a524c"

# Pane borders
set -g pane-border-style "fg=#59524d"
set -g pane-border-status off
set -g pane-active-border-style "fg=#e78a4e"

# Keybinds

# Remove confirmation prompts
unbind x
unbind &
bind x killp
bind & killw

# Window navigation
unbind Up ; unbind Down ; unbind Left ; unbind Right

unbind v
unbind s
unbind M-o
bind -n M-v selectl even-horizontal
bind -n M-s selectl even-vertical
bind -n M-o rotatew -UZ
bind -n M-O rotatew -DZ

unbind '"'
unbind %
bind -n M-\\ run "tmux-splitw '#T' -h"
bind -n M-- run "tmux-splitw '#T' -v"
bind -n M-c neww -c "#{pane_current_path}"

set -g @ssh-split-keep-cwd true
set -g @ssh-split-keep-remote-cwd true
set -g @ssh-split-fail false
set -g @ssh-split-no-shell true
set -g @ssh-split-strip-cmd true
set -g @ssh-split-verbose true
set -g @ssh-split-h-key \\
set -g @ssh-split-v-key -
set -g @ssh-split-w-key c
set -g @ssh-split-r-key r

# Bind these in case I"m in a program like vim that
# doesn"t have my tmux.lua plugin
bind h selectp -L
bind j selectp -D
bind k selectp -U
bind l selectp -R

set -g @tmux-nvim-navigation-keybinding-left "M-h"
set -g @tmux-nvim-navigation-keybinding-down "M-j"
set -g @tmux-nvim-navigation-keybinding-up "M-k"
set -g @tmux-nvim-navigation-keybinding-right "M-l"
bind -n M-n selectw -n
bind -n M-p selectw -p

bind -n M-f {
  set -g cursor-style bar
  run "sesh connect \"$(\
  sesh list --icons | fzf --tmux \
    --no-sort --ansi --border-label ' sesh ' --prompt '‚ö°' --info=hidden \
    --bind 'ctrl-a:change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --bind 'ctrl-t:change-prompt(ü™ü  )+reload(sesh list -t --icons)' \
    --bind 'ctrl-g:change-prompt(‚öôÔ∏è  )+reload(sesh list -c --icons)' \
    --bind 'ctrl-x:change-prompt(üìÅ  )+reload(sesh list -z --icons)' \
    --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(‚ö°  )+reload(sesh list --icons)' \
  )\""
  set -g cursor-style block
}

unbind C-Up
unbind C-Down
unbind C-Left
unbind C-Right
unbind M-Up
unbind M-Down
unbind M-Left
unbind M-Right
set -g @tmux-nvim-resize false
bind -r -n M-H resizep -L
bind -r -n M-J resizep -D
bind -r -n M-K resizep -U
bind -r -n M-L resizep -R

set -g repeat-time 1000

unbind 0
unbind 1
unbind 2
unbind 3
unbind 4
unbind 5
unbind 6
unbind 7
unbind 8
unbind 9
bind -n M-1 selectw -t 1
bind -n M-2 selectw -t 2
bind -n M-3 selectw -t 3
bind -n M-4 selectw -t 4
bind -n M-5 selectw -t 5
bind -n M-6 selectw -t 6
bind -n M-7 selectw -t 7
bind -n M-8 selectw -t 8
bind -n M-9 selectw -t 9

# Copy mode
setw -g mode-keys vi
unbind -T copy-mode-vi v
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection
bind -T copy-mode-vi Y send -X copy-end-of-line

bind -n C-, copy-mode \; send -X -N 2 search-backward ".* ¬ª .*" \; send -X scroll-top
bind -T copy-mode-vi C-, send -X search-backward ".* ¬ª .*" \; send -X scroll-top
bind -T copy-mode-vi c-. send -X search-forward ".* ¬ª .*" \; send -X scroll-top

bind -T copy-mode-vi C-p send -X search-backward "^\(gdb\) .*" \; send -X scroll-top
bind -T copy-mode-vi C-n send -X search-forward "^\(gdb\) .*" \; send -X scroll-top

# Plugins
set -g @plugin "tmux-plugins/tpm"
set -g @plugin "tmux-plugins/tmux-sensible"
set -g @plugin "joshmedeski/tmux-nerd-font-window-name"
set -g @plugin "aserowy/tmux.nvim"
set -g @plugin "tmux-plugins/tmux-resurrect"
set -g @plugin "tmux-plugins/tmux-continuum"
set -g @plugin "pschmitt/tmux-ssh-split"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run "~/.tmux/plugins/tpm/tpm"

# vim: ft=tmux
